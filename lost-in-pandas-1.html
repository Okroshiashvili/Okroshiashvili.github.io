<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="https://dsfabric.org/theme/css/elegant.prod.9e9d5ce754.css" media="screen">
        <link rel="stylesheet" type="text/css" href="https://dsfabric.org/theme/css/custom.css" media="screen">

        <link rel="dns-prefetch" href="//fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>

        <meta name="author" content="Nodar Okroshiashvili" />

        <meta name="description" content="Practical Pandas tips and tricks from everyday use
" />
        <meta name="twitter:creator" content="@N_Okroshiashvil">
        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="Pandas, Analytics, Data Science, Data Science, pandas, python, data analysis, pandas tips and tricks, advance pandas, data transformation in pandas, flatten dict in pandas" />

<meta property="og:title" content="Lost in Pandas: #1 "/>
<meta property="og:url" content="https://dsfabric.org/lost-in-pandas-1" />
<meta property="og:description" content="Practical Pandas tips and tricks from everyday use" />
<meta property="og:site_name" content="Data Science Fabric" />
<meta property="og:article:author" content="Nodar Okroshiashvili" />
<meta property="og:article:published_time" content="2020-04-10T19:14:00+04:00" />
<meta name="twitter:title" content="Lost in Pandas: #1 ">
<meta name="twitter:description" content="Practical Pandas tips and tricks from everyday use">

        <title>Lost in Pandas: #1  Â· Data Science Fabric
</title>
        <link rel="shortcut icon" href="https://dsfabric.org/theme/images/favicon.ico" type="image/x-icon" />
        <link rel="icon" href="https://dsfabric.org/theme/images/apple-touch-icon-152x152.png" type="image/png" />
        <link rel="apple-touch-icon" href="https://dsfabric.org/theme/images/apple-touch-icon.png"  type="image/png" />
        <link rel="apple-touch-icon" sizes="57x57" href="https://dsfabric.org/theme/images/apple-touch-icon-57x57.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="72x72" href="https://dsfabric.org/theme/images/apple-touch-icon-72x72.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="76x76" href="https://dsfabric.org/theme/images/apple-touch-icon-76x76.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="114x114" href="https://dsfabric.org/theme/images/apple-touch-icon-114x114.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="120x120" href="https://dsfabric.org/theme/images/apple-touch-icon-120x120.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="144x144" href="https://dsfabric.org/theme/images/apple-touch-icon-144x144.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="152x152" href="https://dsfabric.org/theme/images/apple-touch-icon-152x152.png" type="image/png" />
        <link rel="apple-touch-icon" sizes="152x152" href="https://dsfabric.org/theme/images/apple-touch-icon-180x180.png" type="image/png" />
        <link href="https://dsfabric.org/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Data Science Fabric - Full Atom Feed" />
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-136307659-1', 'auto');
    ga('send', 'pageview');
</script>


    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="https://dsfabric.org/"><span class=site-name>Data Science Fabric</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                    <a href=
                                       https://dsfabric.org
                                    >Home</a>
                                </li>
                                <li ><a href="https://dsfabric.org/categories">Categories</a></li>
                                <li ><a href="https://dsfabric.org/tags">Tags</a></li>
                                <li ><a href="https://dsfabric.org/archives">Archives</a></li>
                                <li><form class="navbar-search" action="https://dsfabric.org/search" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="https://dsfabric.org/lost-in-pandas-1">
                Lost in Pandas: #1
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">
            
            <p>Many have been told and written about Pandas and its capabilities. 
I could not imagine data scientist or data analyst who had not heard about Pandas or had not used it at least once. 
We all use it. Every day, every week. It does not matter how many times. It's a great tool. 
I use it all the time when I want to do data analysis, either it is simple calculations or complex data transformations, and it surprises me. 
Pandas is so simple in its form. However, imagine, how much you can do with some simple method chaining.</p>
<p>Saying all of these, this blog aims to share my experience and amazment with Pandas. 
This series is not meant for beginner users and will not be short in length. These series will be based on my experience and 
I will try to give a detailed explanation for every step from problem definition to solving it. That's enough for now. Let get down to business.</p>
<h3 id="problem-statement">Problem Statement<a class="headerlink" href="#problem-statement" title="Permanent link">&para;</a></h3>
<p>We have data. This data comes from the HR department of the company. The data contains two columns, company name, and information about its employees. 
Each row of the employee information column is a list of lists. The lists inside the outer list can be duplicated. 
It also can have duplicate values, and inner lists have at most two values. </p>
<blockquote>
<p>Disclaimer: Any name, phone, email, and the title is a pure coincidence. Data is random and fake.</p>
</blockquote>
<p>Here is our data.</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;company_name&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">],</span>
        <span class="s2">&quot;info&quot;</span><span class="p">:</span> <span class="p">[</span>
<span class="p">[[</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="s1">&#39;David Jones&#39;</span><span class="p">],[</span><span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="s1">&#39;CEO&#39;</span><span class="p">],[</span><span class="s1">&#39;Phone&#39;</span><span class="p">,</span> <span class="s1">&#39;207-685-1626&#39;</span><span class="p">],[</span><span class="s1">&#39;Email&#39;</span><span class="p">,</span> <span class="s1">&#39;djones@example.org&#39;</span><span class="p">]],</span>

<span class="p">[[</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Kate Brown&#39;</span><span class="p">],[</span><span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="s1">&#39;Senior Lawyer&#39;</span><span class="p">],[</span><span class="s1">&#39;Phone&#39;</span><span class="p">,</span> <span class="s1">&#39;316-978-7791&#39;</span><span class="p">],</span>
<span class="p">[</span><span class="s1">&#39;Email&#39;</span><span class="p">,</span> <span class="s1">&#39;Kate.Brown@example.edu&#39;</span><span class="p">],[</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Darin White&#39;</span><span class="p">],[</span><span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="s1">&#39;Associate Vice President&#39;</span><span class="p">],</span>
<span class="p">[</span><span class="s1">&#39;Phone&#39;</span><span class="p">,</span> <span class="s1">&#39;316-978-3887&#39;</span><span class="p">],[</span><span class="s1">&#39;Email&#39;</span><span class="p">,</span> <span class="s1">&#39;Darin.White@example.edu&#39;</span><span class="p">]],</span>

<span class="p">[[</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Scott Lamb&#39;</span><span class="p">],[</span><span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="s1">&#39;Actuary&#39;</span><span class="p">],[</span><span class="s1">&#39;Phone&#39;</span><span class="p">,</span> <span class="s1">&#39;316-978-3804&#39;</span><span class="p">],</span>
<span class="p">[</span><span class="s1">&#39;Email&#39;</span><span class="p">,</span> <span class="s1">&#39;scott.lamb@example.edu&#39;</span><span class="p">],[</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Scott Lamb&#39;</span><span class="p">],[</span><span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="s1">&#39;Senior Officer&#39;</span><span class="p">],</span>
<span class="p">[</span><span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="s1">&#39;Application Developer&#39;</span><span class="p">],[</span><span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="s1">&#39;Blockchain Architect&#39;</span><span class="p">],[</span><span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="s1">&#39;Director of External Affairs&#39;</span><span class="p">],[</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Scott&#39;</span><span class="p">],</span>
<span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Scott&#39;</span><span class="p">],[</span><span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="s1">&#39;Director of Medicine&#39;</span><span class="p">],[</span><span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="s1">&#39;Product Owner&#39;</span><span class="p">],</span>
<span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Mike&#39;</span><span class="p">],[</span><span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="s1">&#39;Domain Expert&#39;</span><span class="p">],[</span><span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="s1">&#39;Growth Hacker&#39;</span><span class="p">],</span>
<span class="p">[</span><span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="s1">&#39;Engineering Head&#39;</span><span class="p">],[</span><span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="s1">&#39;Event Manager&#39;</span><span class="p">],[</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Joe&#39;</span><span class="p">],</span>
<span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Mike&#39;</span><span class="p">],[</span><span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="s1">&#39;Fundraising&#39;</span><span class="p">],[</span><span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="s1">&#39;VP of Customers&#39;</span><span class="p">],</span>
<span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Mike&#39;</span><span class="p">],[</span><span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="s1">&#39;Venture Capital Analyst&#39;</span><span class="p">],[</span><span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="s1">&#39;UX Designer&#39;</span><span class="p">],</span>
<span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Mike&#39;</span><span class="p">],[</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Susan&#39;</span><span class="p">],[</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Bryan&#39;</span><span class="p">],[</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Mia&#39;</span><span class="p">],[</span><span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="s1">&#39;Songwriter&#39;</span><span class="p">]],</span>

<span class="p">[[</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Rose Smith Rose Smith&#39;</span><span class="p">],[</span><span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="s1">&#39;Vice President&#39;</span><span class="p">],</span>
<span class="p">[</span><span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="s1">&#39;Finance and Operations Head&#39;</span><span class="p">],[</span><span class="s1">&#39;Phone&#39;</span><span class="p">,</span> <span class="s1">&#39;316-978-3810&#39;</span><span class="p">],</span>
<span class="p">[</span><span class="s1">&#39;Email&#39;</span><span class="p">,</span> <span class="s1">&#39;rose.smith@example.edu&#39;</span><span class="p">],[</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Rose Smith&#39;</span><span class="p">],</span>
<span class="p">[</span><span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="s1">&#39;Foundation&#39;</span><span class="p">],[</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Susan&#39;</span><span class="p">],[</span><span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="s1">&#39;Foundation&#39;</span><span class="p">],</span>
<span class="p">[</span><span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="s1">&#39;Accountant&#39;</span><span class="p">],[</span><span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="s1">&#39;Accountant&#39;</span><span class="p">],[</span><span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="s1">&#39;Executive&#39;</span><span class="p">],</span>
<span class="p">[</span><span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="s1">&#39;Director&#39;</span><span class="p">],[</span><span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="s1">&#39;Executive&#39;</span><span class="p">],[</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Ray&#39;</span><span class="p">],</span>
<span class="p">[</span><span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="s1">&#39;Strategic Planning&#39;</span><span class="p">],[</span><span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="s1">&#39;Financial Analyst&#39;</span><span class="p">],[</span><span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="s1">&#39;Foundation&#39;</span><span class="p">],</span>
<span class="p">[</span><span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="s1">&#39;Foundation&#39;</span><span class="p">],[</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Susan&#39;</span><span class="p">],[</span><span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="s1">&#39;member of the board&#39;</span><span class="p">],</span>
<span class="p">[</span><span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="s1">&#39;board of directors&#39;</span><span class="p">],[</span><span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="s1">&#39;president&#39;</span><span class="p">],[</span><span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="s1">&#39;board of directors&#39;</span><span class="p">]],</span>

<span class="p">[[</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Carl Clark&#39;</span><span class="p">],[</span><span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="s1">&#39;Chief &#39;</span><span class="p">],[</span><span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="s1">&#39;Operating Officer&#39;</span><span class="p">],</span>
<span class="p">[</span><span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="s1">&#39;PhD&#39;</span><span class="p">],[</span><span class="s1">&#39;Phone&#39;</span><span class="p">,</span> <span class="s1">&#39;413-534-2745&#39;</span><span class="p">],[</span><span class="s1">&#39;Email&#39;</span><span class="p">,</span> <span class="s1">&#39;Clark_Carl@example.com&#39;</span><span class="p">]],</span>

<span class="p">[[</span><span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="s1">&#39;Board Member&#39;</span><span class="p">],[</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Taylor Garcia&#39;</span><span class="p">],[</span><span class="s1">&#39;Phone&#39;</span><span class="p">,</span> <span class="s1">&#39;307-733-2164&#39;</span><span class="p">],</span>
<span class="p">[</span><span class="s1">&#39;Phone&#39;</span><span class="p">,</span> <span class="s1">&#39;307-733-4568&#39;</span><span class="p">],[</span><span class="s1">&#39;Email&#39;</span><span class="p">,</span> <span class="s1">&#39;Garcia@example.org&#39;</span><span class="p">]]</span>
        <span class="p">]</span>
<span class="p">}</span>
</pre></div>


<p>Let convert this dictionary into Pandas DataFrame and see what data we have.</p>
<div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c1"># Print DataFrame head</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">  company_name                                               info</span>
<span class="err">0            A  [[Name, David Jones], [Title, CEO], [Phone, 20...</span>
<span class="err">1            B  [[Name, Kate Brown], [Title, Senior Lawyer], [...</span>
<span class="err">2            C  [[Name, Scott Lamb], [Title, Actuary], [Phone,...</span>
<span class="err">3            D  [[Name, Rose Smith Rose Smith], [Title, Vice P...</span>
<span class="err">4            E  [[Name, Carl Clark], [Title, Chief ], [Title, ...</span>
</pre></div>


<p>We see that the first column seems okay, but the second one not. Here we have one big list containing smaller two-element lists.</p>
<div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;info&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">[[&#39;Name&#39;, &#39;Scott Lamb&#39;],</span>
<span class="err"> [&#39;Title&#39;, &#39;Actuary&#39;],</span>
<span class="err"> [&#39;Phone&#39;, &#39;316-978-3804&#39;],</span>
<span class="err"> [&#39;Email&#39;, &#39;scott.lamb@example.edu&#39;],</span>
<span class="err"> [&#39;Name&#39;, &#39;Scott Lamb&#39;],</span>
<span class="err"> [&#39;Title&#39;, &#39;Senior Officer&#39;],</span>
<span class="err"> [&#39;Title&#39;, &#39;Application Developer&#39;],</span>
<span class="err"> [&#39;Title&#39;, &#39;Blockchain Architect&#39;],</span>
<span class="err"> [&#39;Title&#39;, &#39;Director of External Affairs&#39;],</span>
<span class="err"> [&#39;Name&#39;, &#39;Scott&#39;],</span>
<span class="err"> [&#39;Name&#39;, &#39;Scott&#39;],</span>
<span class="err"> [&#39;Title&#39;, &#39;Director of Medicine&#39;],</span>
<span class="err"> [&#39;Title&#39;, &#39;Product Owner&#39;],</span>
<span class="err"> [&#39;Name&#39;, &#39;Mike&#39;],</span>
<span class="err"> [&#39;Title&#39;, &#39;Domain Expert&#39;],</span>
<span class="err"> [&#39;Title&#39;, &#39;Growth Hacker&#39;],</span>
<span class="err"> [&#39;Title&#39;, &#39;Engineering Head&#39;],</span>
<span class="err"> [&#39;Title&#39;, &#39;Event Manager&#39;],</span>
<span class="err"> [&#39;Name&#39;, &#39;Joe&#39;],</span>
<span class="err"> [&#39;Name&#39;, &#39;Mike&#39;],</span>
<span class="err"> [&#39;Title&#39;, &#39;Fundraising&#39;],</span>
<span class="err"> [&#39;Title&#39;, &#39;VP of Customers&#39;],</span>
<span class="err"> [&#39;Name&#39;, &#39;Mike&#39;],</span>
<span class="err"> [&#39;Title&#39;, &#39;Venture Capital Analyst&#39;],</span>
<span class="err"> [&#39;Title&#39;, &#39;UX Designer&#39;],</span>
<span class="err"> [&#39;Name&#39;, &#39;Mike&#39;],</span>
<span class="err"> [&#39;Name&#39;, &#39;Susan&#39;],</span>
<span class="err"> [&#39;Name&#39;, &#39;Bryan&#39;],</span>
<span class="err"> [&#39;Name&#39;, &#39;Mia&#39;],</span>
<span class="err"> [&#39;Title&#39;, &#39;Songwriter&#39;]]</span>
</pre></div>


<p>As we figured out the data structure, let define the aim. </p>
<p><strong>We need to unpack lists from the second column and flatten them in tabular format in the way to preserve the order. 
Meaning that, from the above example, <code>Scott Lamb</code> has to have title <code>Actuary</code> and not other titles are allowed. 
Long story short, we need to flatten list of list and make proper DataFrame from it.</strong></p>
<h3 id="how-i-approached-this-problem">How I approached this problem<a class="headerlink" href="#how-i-approached-this-problem" title="Permanent link">&para;</a></h3>
<p>The first idea that came to my mind was to use Pandas DataFrame <code>.explode()</code> method to unpack list of lists, 
which returned lists containing two elements. After that, I extracted these two elements into two different columns.</p>
<div class="highlight"><pre><span></span><span class="n">df_exploded</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>

<span class="n">df_exploded</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">  company_name                         info</span>
<span class="err">0            A          [Name, David Jones]</span>
<span class="err">0            A                 [Title, CEO]</span>
<span class="err">0            A        [Phone, 207-685-1626]</span>
<span class="err">0            A  [Email, djones@example.org]</span>
<span class="err">1            B           [Name, Kate Brown]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># Add two new columns</span>
<span class="n">df_exploded</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;tag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_exploded</span><span class="p">[</span><span class="s1">&#39;info&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">df_exploded</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;result&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_exploded</span><span class="p">[</span><span class="s1">&#39;info&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">df_exploded</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">  company_name                         info    tag              result</span>
<span class="err">0            A          [Name, David Jones]   Name         David Jones</span>
<span class="err">0            A                 [Title, CEO]  Title                 CEO</span>
<span class="err">0            A        [Phone, 207-685-1626]  Phone        207-685-1626</span>
<span class="err">0            A  [Email, djones@example.org]  Email  djones@example.org</span>
<span class="err">1            B           [Name, Kate Brown]   Name          Kate Brown</span>
</pre></div>


<p>Despite unpacking the list of lists, that is not the format I wanted. So, I need to do an extra transformation.</p>
<div class="highlight"><pre><span></span><span class="n">df_exploded_final</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_exploded</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;company_name&#39;</span><span class="p">,</span> <span class="s1">&#39;tag&#39;</span><span class="p">])[</span><span class="s1">&#39;result&#39;</span><span class="p">]</span>
                                 <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
                                 <span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                                 <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
                                 <span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;level_1&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

<span class="n">df_exploded_final</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">tag company_name                    Email         Name         Phone                      tag</span>
<span class="err">0              A       djones@example.org  David Jones  207-685-1626                      CEO</span>
<span class="err">1              B   Kate.Brown@example.edu   Kate Brown  316-978-7791             Senior Lawyer</span>
<span class="err">2              B  Darin.White@example.edu  Darin White  316-978-3887  Associate Vice President</span>
<span class="err">3              C   scott.lamb@example.edu   Scott Lamb  316-978-3804                   Actuary</span>
<span class="err">4              C                      NaN   Scott Lamb           NaN            Senior Officer</span>
</pre></div>


<p>It seems we did a good job. However, this approach is prone to errors. Namely, it does not preserve the order 
of the list values and may assign a different email to a different person. That was not what I need.</p>
<p>So, I decided to use another way to solve this problem. Notably, as the data contained millions of rows, 
it seemed impossible to be too precise, but I wanted to reduce the error of non-matching cases. To achieve this, I iterated over 
the values of <code>info</code> column and converted it to dict of lists, where keys are tags (identifiers) and values are actual employee information.</p>
<div class="highlight"><pre><span></span><span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;info&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">():</span>
    <span class="n">groups</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">g</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
        <span class="n">groups</span><span class="p">[</span><span class="n">g</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">groups</span><span class="p">))</span>


<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;new_info&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span>

<span class="n">df</span><span class="p">[</span><span class="s1">&#39;new_info&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">{&#39;Name&#39;: [&#39;David Jones&#39;],</span>
<span class="err"> &#39;Title&#39;: [&#39;CEO&#39;],</span>
<span class="err"> &#39;Phone&#39;: [&#39;207-685-1626&#39;],</span>
<span class="err"> &#39;Email&#39;: [&#39;djones@example.org&#39;]}</span>
</pre></div>


<p>That's a step forward. After this, I was interested in counting the values for each key in dicts for each row. 
I made small changes in the above code and applied it to the <code>new_info</code> column.</p>
<div class="highlight"><pre><span></span><span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;new_info&#39;</span><span class="p">]:</span>
    <span class="n">groups</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">g</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>       
        <span class="n">groups</span><span class="p">[</span><span class="n">g</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">v</span><span class="p">)))</span>
    <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">groups</span><span class="p">))</span>


<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;new_info_stats&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span>

<span class="n">df</span><span class="p">[</span><span class="s1">&#39;new_info_stats&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">{&#39;Name&#39;: 1, &#39;Title&#39;: 1, &#39;Phone&#39;: 1, &#39;Email&#39;: 1}</span>
</pre></div>


<p>As we calculated value counts for each dict, now we need to add three helper columns to the dataset for further usage. 
These helper columns will help to differentiate matching cases and non-matching cases.</p>
<div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;_max&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;new_info_stats&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>

<span class="n">df</span><span class="p">[</span><span class="s1">&#39;_min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;new_info_stats&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>

<span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;max_equal_min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;_max&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;_min&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</pre></div>


<p>The column <code>max_equal_min</code> is a dummy variable and helps us to differentiate matching and non-matching cases. 
The value 1 indicates we have a matching case and value 0 - non-matching case. According to this column, 
I split data into two parts. The first only contains matching examples, and the second will have only non-matching cases.</p>
<div class="highlight"><pre><span></span><span class="n">df_first</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;max_equal_min&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

<span class="n">df_second</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;max_equal_min&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>


<p>The pre-processing of the first DataFrame is over and is ready to flatten. To do so, I iterate over 
<code>new_info</code> column and transform each row into Pandas DataFrame. After this step, data will be flat.</p>
<div class="highlight"><pre><span></span><span class="n">new_data</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">df_first</span><span class="p">[</span><span class="s1">&#39;new_info&#39;</span><span class="p">]:</span>
    <span class="n">new_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>


<span class="n">df_first_final_i</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">new_data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                  <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
                  <span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">])</span>
                  <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

<span class="n">df_first_final_i</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">          Name                     Title         Phone                    Email</span>
<span class="err">0  David Jones                       CEO  207-685-1626       djones@example.org</span>
<span class="err">1   Kate Brown             Senior Lawyer  316-978-7791   Kate.Brown@example.edu</span>
<span class="err">2  Darin White  Associate Vice President  316-978-3887  Darin.White@example.edu</span>
</pre></div>


<p>Woohoo, it works! However, imagine having millions of rows how slow this approach will be. 
For this reason, I tried another method and found it much faster. Here it is.</p>
<div class="highlight"><pre><span></span><span class="n">df_first_final_ii</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_first</span><span class="p">[</span><span class="s1">&#39;new_info&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span>
                                        <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">explode</span><span class="p">())</span>
                                        <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
                                        <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

<span class="n">df_first_final_ii</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">          Name                     Title         Phone                    Email</span>
<span class="err">0  David Jones                       CEO  207-685-1626       djones@example.org</span>
<span class="err">1   Kate Brown             Senior Lawyer  316-978-7791   Kate.Brown@example.edu</span>
<span class="err">2  Darin White  Associate Vice President  316-978-3887  Darin.White@example.edu</span>
</pre></div>


<p>Faster and cleaner solution. But, what about the second DataFrame? It turned out that the above solution 
did not fit the second DataFrame and gave me an error. The error was <code>ValueError: cannot reindex from a duplicate axis</code>. 
Before finding the solution for this error, let take a look at the data.</p>
<div class="highlight"><pre><span></span><span class="n">df_second</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span>  <span class="n">company_name</span>                                               <span class="n">info</span>  <span class="err">\</span>
<span class="mi">0</span>            <span class="k">C</span>  <span class="p">[[</span><span class="n">Name</span><span class="p">,</span> <span class="n">Scott</span> <span class="n">Lamb</span><span class="p">],</span> <span class="p">[</span><span class="n">Title</span><span class="p">,</span> <span class="n">Actuary</span><span class="p">],</span> <span class="p">[</span><span class="n">Phone</span><span class="p">,...</span>
<span class="mi">1</span>            <span class="n">D</span>  <span class="p">[[</span><span class="n">Name</span><span class="p">,</span> <span class="n">Rose</span> <span class="n">Smith</span> <span class="n">Rose</span> <span class="n">Smith</span><span class="p">],</span> <span class="p">[</span><span class="n">Title</span><span class="p">,</span> <span class="n">Vice</span> <span class="n">P</span><span class="p">...</span>
<span class="mi">2</span>            <span class="n">E</span>  <span class="p">[[</span><span class="n">Name</span><span class="p">,</span> <span class="n">Carl</span> <span class="n">Clark</span><span class="p">],</span> <span class="p">[</span><span class="n">Title</span><span class="p">,</span> <span class="n">Chief</span> <span class="p">],</span> <span class="p">[</span><span class="n">Title</span><span class="p">,</span> <span class="p">...</span>
<span class="mi">3</span>            <span class="n">F</span>  <span class="p">[[</span><span class="n">Title</span><span class="p">,</span> <span class="n">Board</span> <span class="n">Member</span><span class="p">],</span> <span class="p">[</span><span class="n">Name</span><span class="p">,</span> <span class="n">Taylor</span> <span class="n">Garcia</span><span class="p">],...</span>

                                            <span class="n">new_info</span>  <span class="err">\</span>
<span class="mi">0</span>  <span class="err">{</span><span class="s1">&#39;Name&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Scott Lamb&#39;</span><span class="p">,</span> <span class="s1">&#39;Scott Lamb&#39;</span><span class="p">,</span> <span class="s1">&#39;Scott&#39;</span><span class="p">,...</span>
<span class="mi">1</span>  <span class="err">{</span><span class="s1">&#39;Name&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Rose Smith Rose Smith&#39;</span><span class="p">,</span> <span class="s1">&#39;Rose Smith...</span>
<span class="s1">2  {&#39;</span><span class="n">Name</span><span class="s1">&#39;: [&#39;</span><span class="n">Carl</span> <span class="n">Clark</span><span class="s1">&#39;], &#39;</span><span class="n">Title</span><span class="s1">&#39;: [&#39;</span><span class="n">Chief</span> <span class="s1">&#39;, &#39;</span><span class="p">...</span>
<span class="mi">3</span>  <span class="err">{</span><span class="s1">&#39;Title&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Board Member&#39;</span><span class="p">],</span> <span class="s1">&#39;Name&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Taylor G...</span>

<span class="s1">                                      new_info_stats  _max  _min  max_equal_min</span>
<span class="s1">0  {&#39;</span><span class="n">Name</span><span class="s1">&#39;: 12, &#39;</span><span class="n">Title</span><span class="s1">&#39;: 16, &#39;</span><span class="n">Phone</span><span class="s1">&#39;: 1, &#39;</span><span class="n">Email</span><span class="s1">&#39;: 1}    16     1              0</span>
<span class="s1">1   {&#39;</span><span class="n">Name</span><span class="s1">&#39;: 5, &#39;</span><span class="n">Title</span><span class="s1">&#39;: 17, &#39;</span><span class="n">Phone</span><span class="s1">&#39;: 1, &#39;</span><span class="n">Email</span><span class="s1">&#39;: 1}    17     1              0</span>
<span class="s1">2    {&#39;</span><span class="n">Name</span><span class="s1">&#39;: 1, &#39;</span><span class="n">Title</span><span class="s1">&#39;: 3, &#39;</span><span class="n">Phone</span><span class="s1">&#39;: 1, &#39;</span><span class="n">Email</span><span class="s1">&#39;: 1}     3     1              0</span>
<span class="s1">3    {&#39;</span><span class="n">Title</span><span class="s1">&#39;: 1, &#39;</span><span class="n">Name</span><span class="s1">&#39;: 1, &#39;</span><span class="n">Phone</span><span class="s1">&#39;: 2, &#39;</span><span class="n">Email</span><span class="err">&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="err">}</span>     <span class="mi">2</span>     <span class="mi">1</span>              <span class="mi">0</span>
</pre></div>


<p>In the second and third row, we have one <code>Name</code> and three <code>Title</code> and two <code>Phone</code>, 
respectively, for the <code>new_info_stats</code> column. This may be due to the data entry or extraction reason. 
Not 100% sure that this is the case, but the likelihood is very high. So, we have to handle this problem properly. 
One solution is to concatenate strings for the values of <code>Title</code> and <code>Phone</code> keys.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">process_info</span><span class="p">(</span><span class="n">record</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">and</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Name&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Title&#39;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Email&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Phone&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">record</span><span class="p">[</span><span class="s1">&#39;Title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Title&#39;</span><span class="p">))]</span>

    <span class="k">elif</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">and</span>
          <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Name&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span>
          <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Title&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span>
          <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Email&#39;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span>
          <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Phone&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">record</span><span class="p">[</span><span class="s1">&#39;Email&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Email&#39;</span><span class="p">))]</span>

    <span class="k">elif</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">and</span>
          <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Name&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span>
          <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Title&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span>
          <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Email&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span>
          <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Phone&#39;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">record</span><span class="p">[</span><span class="s1">&#39;Phone&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Phone&#39;</span><span class="p">))]</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">return</span> <span class="n">record</span>



<span class="n">df_second</span><span class="p">[</span><span class="s1">&#39;new_info&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_second</span><span class="p">[</span><span class="s1">&#39;new_info&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">process_info</span><span class="p">)</span>
</pre></div>


<p>This is a simple logic to check if we are correctly concatenating string. 
After applying this function, the second DataFrame is ready to flatten. 
As I mentioned above the good old method did not give me 
the desired result for this case and then I came up to the following:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">flatten</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">]:</span>
        <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">([(</span><span class="n">k</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">items</span><span class="p">()])))</span>

    <span class="n">new_df</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
                <span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">])</span>
                <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="s1">&#39;Phone&#39;</span><span class="p">,</span> <span class="s1">&#39;Email&#39;</span><span class="p">])</span>
                <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">new_df</span>


<span class="n">df_second_final</span> <span class="o">=</span> <span class="n">flatten</span><span class="p">(</span><span class="n">df_second</span><span class="p">,</span> <span class="s1">&#39;new_info&#39;</span><span class="p">)</span>

<span class="n">df_second_final</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="err">         Name                         Title         Phone                   Email</span>
<span class="err">0  Scott Lamb                       Actuary  316-978-3804  scott.lamb@example.edu</span>
<span class="err">1  Scott Lamb                Senior Officer           NaN                     NaN</span>
<span class="err">2       Scott         Application Developer           NaN                     NaN</span>
<span class="err">3       Scott          Blockchain Architect           NaN                     NaN</span>
<span class="err">4        Mike  Director of External Affairs           NaN                     NaN</span>
</pre></div>


<p>Applied this function to the second DataFrame flattened it, and combining first and second DataFrames will give the final result.</p>
<p>To sum up, that was only a tiny part of this data pre-processing process. 
However, it was a great journey and lots to learn. What do you think? Did you find a more elegant solution? Please share it in the comments.</p>


             


<div class="applause_button">
    <applause-button url=https://dsfabric.org/lost-in-pandas-1> </applause-button>
</div>

 
                <p id="post-share-links">
    Like this post? Share on:
      <a href="https://twitter.com/intent/tweet?text=Lost%20in%20Pandas%3A%20%231&url=https%3A//dsfabric.org/lost-in-pandas-1&via=N_Okroshiashvil&hashtags=pandas,analytics,data-science" target="_blank" rel="nofollow noopener noreferrer" title="Share on Twitter">Twitter</a>
 â       <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A//dsfabric.org/lost-in-pandas-1" target="_blank" rel="nofollow noopener noreferrer" title="Share on Facebook">Facebook</a>
 â       <a href="mailto:?subject=Lost%20in%20Pandas%3A%20%231&amp;body=https%3A//dsfabric.org/lost-in-pandas-1" target="_blank" rel="nofollow noopener noreferrer" title="Share via Email">Email</a>

            
            







<section>
    <h6 style="display:none;">Comments</h6>
    <p id="comment-message">So what do you think? Did I miss something? Is any part unclear? Leave your comments below. </p>

    <div class="accordion" id="accordion2">
        <div class="accordion-group">
            <div class="accordion-heading">
                <a class="accordion-toggle disqus-comment-count comment-count collapsed"
                   data-toggle="collapse"
                   data-parent="#accordion2"
                   data-disqus-identifier="https://dsfabric.org/lost-in-pandas-1"
                   href="https://dsfabric.org/lost-in-pandas-1#comment_thread"
                   id="comment-accordion-toggle">
                    Comments
                </a>
            </div>
            <div id="comment_thread" class="accordion-body collapse">
                <div class="accordion-inner">
                    <div class="comments">
                        <div id="disqus_thread"></div>
                        <script>
    var disqus_shortname = 'dsfabric';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());

    var disqus_identifier = 'https://dsfabric.org/lost-in-pandas-1';
    var disqus_url = 'https://dsfabric.org/lost-in-pandas-1';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

<noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>




                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

            <hr/>
            <aside>
            <nav>
            <ul class="articles-timeline">
                <li class="previous-article">Â« <a href="https://dsfabric.org/modeling-single-good-market-in-python" title="Previous: Modeling single good market in Python">Modeling single good market in Python</a></li>
                <li class="next-article"><a href="https://dsfabric.org/integer-sequences-in-python" title="Next: Integer Sequences in Python">Integer Sequences in Python</a> Â»</li>
            </ul>
            </nav>
            </aside>
        </div>
        <section id="article-sidebar" class="span2">
            <h4>Published</h4>
            <time itemprop="dateCreated" datetime="2020-04-10T19:14:00+04:00">ááá  10 ááá ááá 2020</time>
            <h4>Category</h4>
            <a class="category-link" href="https://dsfabric.org/categories#data-science-ref">Data Science</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="https://dsfabric.org/tags#analytics-ref">Analytics
                    <span class="superscript">1</span>
</a></li>
                <li><a href="https://dsfabric.org/tags#pandas-ref">Pandas
                    <span class="superscript">1</span>
</a></li>
                <li><a href="https://dsfabric.org/tags#data-science-ref">Data Science
</a></li>
            </ul>
<h4>Stay in Touch</h4>
<div id="sidebar-social-link">
    <a href="https://www.linkedin.com/in/nodar-okroshiashvili/" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="LinkedIn" role="img" viewBox="0 0 512 512" fill="#fff"><rect width="512" height="512" rx="15%" fill="#0077b5"/><circle cx="142" cy="138" r="37"/><path stroke="#fff" stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg>
    </a>
    <a href="https://github.com/Okroshiashvili" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="GitHub" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1B1817"/><path fill="#fff" d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
    </a>
    <a href="https://twitter.com/N_Okroshiashvil" title="" target="_blank" rel="nofollow noopener noreferrer">
        <svg xmlns="http://www.w3.org/2000/svg" aria-label="Twitter" role="img" viewBox="0 0 512 512"><rect width="512" height="512" rx="15%" fill="#1da1f3"/><path fill="#fff" d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
    </a>
</div>
            





            





        </section>
</div>
</article>
<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe.
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides.
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo https://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>
    <div>
        Content licensed under <a rel="license nofollow noopener noreferrer"
    href="http://creativecommons.org/licenses/by/4.0/" target="_blank">
    Creative Commons Attribution 4.0 International License</a>.
    </div>

    <div>
        <span class="site-name">Data Science Fabric</span> - Torture the data, and it will confess to anything. Ronald Coase
    </div>



    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow noopener noreferrer">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" title="Theme Elegant Home Page" target="_blank" rel="nofollow noopener noreferrer">Elegant</a>
    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script src="https://dsfabric.org/theme/js/elegant.prod.9e9d5ce754.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>